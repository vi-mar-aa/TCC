import {useNavigate } from 'react-router-dom';
import {useState} from 'react';
import './Login.css';
import { LogIn, Eye, EyeOff } from 'lucide-react';
import { listarFuncionarios, Funcionario } from "./ApiManager";




function Login() {
  const [selected, setSelected] = useState<'admin' | 'biblio'>('admin');
  const [showSenha, setShowSenha] = useState(false);
  const navigate = useNavigate();
  const [texto, setTexto] = useState('aa aqui');
  const [inputValor, setInputValor] = useState('');
  const [funcionarios, setFuncionarios] = useState<Funcionario[]>([]);
  const [email, setEmail] = useState('');
  const [senha, setSenha] = useState('');

  //modo escuro
   



  async function handleClick() {
    try {
      const api = ApiManager.getApiService();
  
      const payload = {
        idFuncionario: 0,
        idcargo: 0,
        nome: "string",
        cpf: "string",
        email: email,
        senha: senha,
        telefone: "string",
        statusconta: "string"
      };
  
      const response = await api.post("/LoginFuncionario", payload);
  
      // Salva token
      const token = response.data.token;
      if (token) {
        localStorage.setItem("token", token);
      }
  
      // Salva dados do funcionário logado
      if (response.data.funcionario) {
        localStorage.setItem("funcionario", JSON.stringify(response.data.funcionario));
        console.log(response.data)
      }

      try {
        const FUNCIONARIO = listarFuncionarios()
        const AQUELEFUNCIONARIO = (await FUNCIONARIO).find(f => f.email === email)
        console.log(AQUELEFUNCIONARIO)
        localStorage.setItem("funcionario", JSON.stringify(AQUELEFUNCIONARIO));
        navigate("/dashboard");
      }
      catch
      {
        alert("deu merda quando foi pegar os funcionarios")
      }
      

    } catch (error: any) {
      console.error("Erro ao fazer login:", error);
      alert("Email ou senha incorretos!");
    }
  }
  

  return (
    <>

    
    <div className='conteiner'>
      
      <svg width="178" height="178" viewBox="0 0 178 178" fill="none" xmlns="http://www.w3.org/2000/svg" id="logo">
        <mask id="path-1-inside-1_106_40" fill="white">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M26.3082 3.32993V6.65986H31.6258H36.9434V60.4013V114.143L44.3673 122.156L51.7918 130.17H67.1883H82.5853L87.8822 124.417L93.1791 118.664L99.9134 125.93L106.648 133.197H122.321H137.994L145.122 125.471L152.249 117.744L149.914 115.141L147.579 112.538L141.091 119.538L134.603 126.537H130.273H125.943V87.7891V49.0408H136.858H147.774V45.7109V42.381H136.858H125.943V29.8083V17.2363L119.349 10.1218L112.754 3.00784L97.099 3.16888L81.4434 3.32993L81.2749 6.4861L81.1064 9.64227L86.5925 9.81603L92.0786 9.9898L92.2286 24.369L92.3786 38.7483H81.4535H70.5283V26.1757V13.6025L64.2222 6.80154L57.9166 0H42.1121H26.3082V3.32993ZM92.3585 77.3549V109.301L85.7462 116.434L79.1344 123.568L74.971 123.388L70.8082 123.207L70.6643 84.3078L70.5199 45.4082H81.4395H92.3585V77.3549ZM25.4624 141.075L22.6978 144.111L25.5671 147.214L28.4363 150.318L31.0084 147.661C32.4229 146.199 33.5815 144.721 33.5827 144.375C33.5838 144.03 32.3792 142.463 30.9059 140.893L28.227 138.039L25.4624 141.075ZM31.3459 144.406C31.3459 144.785 30.7089 145.743 29.9303 146.533L28.5147 147.972L26.7347 146.047L24.9553 144.122L26.5785 142.29L28.2012 140.458L29.7736 142.087C30.6384 142.983 31.3459 144.027 31.3459 144.406ZM0 143.187C0 143.752 0.528403 144.095 1.39937 144.095H2.79874V159.421V174.746L4.36884 176.373C5.77492 177.83 6.35818 178 9.96632 178C12.2781 178 13.9937 177.742 13.9937 177.395C13.9937 177.062 13.364 176.789 12.5943 176.789H11.195V161.469V146.149L9.34892 144.214C7.64617 142.428 7.21292 142.279 3.75143 142.279C0.789805 142.279 0 142.47 0 143.187ZM8.30891 145.508C9.51181 146.894 9.53307 147.211 9.38586 161.696C9.24872 175.22 9.15301 176.488 8.25461 176.675C7.71501 176.787 6.51827 176.062 5.59581 175.064L3.91824 173.25V159.076C3.91824 151.281 4.08616 144.721 4.29159 144.499C5.08364 143.642 7.13567 144.158 8.30891 145.508ZM44.0337 146.921C43.2725 147.744 43.7007 148.333 45.0597 148.333H46.4591V161.54V174.746L48.0292 176.373C49.4275 177.823 50.0275 178 53.522 178C57.152 178 57.5651 177.864 59.0568 176.179C60.1321 174.966 60.4825 174.157 60.1097 173.754C59.7363 173.35 59.0126 173.755 57.9373 174.969C57.0507 175.97 55.8685 176.789 55.3104 176.789C54.374 176.789 54.2956 176.063 54.2956 167.405V158.02H56.8145C58.6801 158.02 59.3333 157.785 59.3333 157.112C59.3333 156.44 58.6801 156.204 56.8145 156.204H54.2956V153.208C54.2956 150.609 54.0543 149.966 52.4764 148.367C50.899 146.768 50.2419 146.522 47.5322 146.52C45.8132 146.518 44.2386 146.699 44.0337 146.921ZM68.1029 146.921C67.3417 147.744 67.7699 148.333 69.1289 148.333H70.5283V161.232V174.13L72.3744 176.065C74.0592 177.832 74.5316 178 77.8011 178C80.9245 178 81.5828 177.792 82.9519 176.373C84.4543 174.817 85.0297 173.156 84.0669 173.156C83.8167 173.156 82.8881 173.974 82.0031 174.973C79.1165 178.232 78.9245 177.763 78.9245 167.439V158.09L81.2598 157.904C84.5998 157.638 84.7935 156.204 81.4898 156.204H78.9245V153.501C78.9245 151.34 78.5758 150.368 77.1871 148.657C75.5476 146.637 75.2537 146.517 71.9629 146.517C70.0452 146.517 68.3078 146.699 68.1029 146.921ZM51.475 149.659C52.5481 150.904 52.6164 151.74 52.6164 163.603C52.6164 174.445 52.4943 176.273 51.7482 176.582C51.2478 176.79 50.2996 176.353 49.5092 175.549L48.1384 174.156V161.245C48.1384 148.823 48.1798 148.333 49.236 148.333C49.84 148.333 50.8475 148.93 51.475 149.659ZM75.95 149.65C77.2235 150.944 77.2453 151.177 77.2453 163.594C77.2453 174.475 77.1244 176.272 76.3721 176.584C75.8437 176.804 74.8501 176.273 73.8532 175.241L72.2075 173.535V160.934C72.2075 148.381 72.212 148.333 73.4312 148.333C74.104 148.333 75.2375 148.925 75.95 149.65ZM21.6589 154.169C21.0242 154.856 21.8582 155.599 23.2626 155.599H24.6289V165.101C24.6289 174.589 24.6312 174.607 26.133 176.302C27.5295 177.879 27.9494 178 32.0103 178C36.1648 178 38.1239 177.086 34.8443 176.678L33.305 176.486L33.0252 166.644L32.7453 156.802L31.1187 155.292C29.7366 154.009 28.9312 153.782 25.7546 153.782C23.6986 153.782 21.8559 153.957 21.6589 154.169ZM95.8267 155.779L94.0377 157.775V165.952V174.13L95.8838 176.065L97.7293 178H105.015H112.3L113.865 176.233C116.115 173.693 115.142 172.506 112.812 174.949C111.072 176.773 110.843 176.839 106.858 176.666L102.714 176.486V172.248V168.01L107.467 167.832C111.726 167.672 112.381 167.488 113.764 166.054C115.101 164.669 115.308 163.984 115.308 160.955C115.308 157.893 115.101 157.227 113.648 155.619L111.987 153.782H104.802H97.6156L95.8267 155.779ZM124.264 154.69C124.264 155.255 124.793 155.599 125.664 155.599H127.063V164.864V174.13L128.909 176.065C130.637 177.878 131.01 178 134.786 178C138.676 178 140.429 177.07 137.278 176.678L135.739 176.486L135.583 167.462C135.436 158.875 135.488 158.368 136.661 157.018C138.126 155.33 141.296 155.097 142.796 156.566C144.385 158.121 145.278 156.934 143.8 155.232C142.09 153.263 138.07 153.193 136.195 155.099L134.899 156.415L133.604 155.099C132.522 153.999 131.646 153.782 128.286 153.782C125.084 153.782 124.264 153.968 124.264 154.69ZM155.995 155.481C154.917 156.697 154.491 157.813 154.491 159.416V161.653H158.409H162.327V158.626V155.599H164.286H166.245V160.442V165.286H161.312C156.638 165.286 156.3 165.375 154.875 166.984C152.781 169.348 152.756 173.484 154.82 176.137C156.204 177.916 156.46 178 160.521 178C164.014 178 164.988 177.782 165.975 176.779L167.176 175.559L168.197 176.779C169.055 177.806 169.917 178 173.609 178C176.163 178 178 177.747 178 177.395C178 177.062 177.37 176.789 176.601 176.789H175.201V167.149C175.201 157.66 175.178 157.479 173.752 155.645L172.303 153.782H164.901C157.522 153.782 157.494 153.788 155.995 155.481ZM30.3221 156.601C31.2317 157.491 31.3459 158.671 31.3459 167.196C31.3459 176.154 31.2771 176.789 30.302 176.789C29.7277 176.789 28.5942 176.224 27.7831 175.534L26.3082 174.28V164.939V155.599H27.8033C28.6255 155.599 29.759 156.05 30.3221 156.601ZM100.755 166.194C100.755 176.021 100.681 176.789 99.7399 176.789C99.1818 176.789 98.0483 176.025 97.221 175.091C95.7545 173.435 95.717 173.207 95.717 165.897C95.717 159.034 95.82 158.283 96.9339 157C97.6033 156.23 98.7368 155.599 99.4527 155.599H100.755V166.194ZM106.912 161.048V166.497H104.673H102.434V161.048V155.599H104.673H106.912V161.048ZM112.725 157.091C114.059 159.294 113.899 163.383 112.412 165.096C111.743 165.866 110.609 166.497 109.893 166.497C108.627 166.497 108.591 166.347 108.591 161.048V155.599H110.206C111.305 155.599 112.11 156.076 112.725 157.091ZM132.756 156.601C133.666 157.491 133.78 158.671 133.78 167.196C133.78 176.055 133.702 176.789 132.765 176.789C132.207 176.789 131.073 176.025 130.246 175.091C128.753 173.406 128.742 173.327 128.742 164.496V155.599H130.237C131.059 155.599 132.193 156.05 132.756 156.601ZM160.648 158.057V160.515L158.553 160.327C157.054 160.193 156.404 159.826 156.266 159.035C156.002 157.532 157.73 155.599 159.335 155.599C160.497 155.599 160.648 155.882 160.648 158.057ZM172.685 157.031C173.39 158.196 173.524 160.149 173.397 167.475C173.243 176.415 173.231 176.488 171.928 176.687C171.135 176.809 170.081 176.347 169.269 175.523C167.963 174.195 167.925 173.891 167.925 164.878V155.599H169.871C171.3 155.599 172.048 155.979 172.685 157.031ZM160.648 171.643C160.648 176.753 160.638 176.789 159.223 176.789C158.44 176.789 157.18 176.12 156.424 175.303C153.622 172.273 155.355 166.497 159.066 166.497H160.648V171.643ZM166.245 170.327C166.245 173.598 166.047 174.358 164.887 175.536C164.141 176.295 163.259 176.735 162.928 176.514C162.582 176.282 162.327 174.077 162.327 171.304V166.497H164.286H166.245V170.327Z"/>
        </mask>
        <path fill-rule="evenodd" clip-rule="evenodd" d="M26.3082 3.32993V6.65986H31.6258H36.9434V60.4013V114.143L44.3673 122.156L51.7918 130.17H67.1883H82.5853L87.8822 124.417L93.1791 118.664L99.9134 125.93L106.648 133.197H122.321H137.994L145.122 125.471L152.249 117.744L149.914 115.141L147.579 112.538L141.091 119.538L134.603 126.537H130.273H125.943V87.7891V49.0408H136.858H147.774V45.7109V42.381H136.858H125.943V29.8083V17.2363L119.349 10.1218L112.754 3.00784L97.099 3.16888L81.4434 3.32993L81.2749 6.4861L81.1064 9.64227L86.5925 9.81603L92.0786 9.9898L92.2286 24.369L92.3786 38.7483H81.4535H70.5283V26.1757V13.6025L64.2222 6.80154L57.9166 0H42.1121H26.3082V3.32993ZM92.3585 77.3549V109.301L85.7462 116.434L79.1344 123.568L74.971 123.388L70.8082 123.207L70.6643 84.3078L70.5199 45.4082H81.4395H92.3585V77.3549ZM25.4624 141.075L22.6978 144.111L25.5671 147.214L28.4363 150.318L31.0084 147.661C32.4229 146.199 33.5815 144.721 33.5827 144.375C33.5838 144.03 32.3792 142.463 30.9059 140.893L28.227 138.039L25.4624 141.075ZM31.3459 144.406C31.3459 144.785 30.7089 145.743 29.9303 146.533L28.5147 147.972L26.7347 146.047L24.9553 144.122L26.5785 142.29L28.2012 140.458L29.7736 142.087C30.6384 142.983 31.3459 144.027 31.3459 144.406ZM0 143.187C0 143.752 0.528403 144.095 1.39937 144.095H2.79874V159.421V174.746L4.36884 176.373C5.77492 177.83 6.35818 178 9.96632 178C12.2781 178 13.9937 177.742 13.9937 177.395C13.9937 177.062 13.364 176.789 12.5943 176.789H11.195V161.469V146.149L9.34892 144.214C7.64617 142.428 7.21292 142.279 3.75143 142.279C0.789805 142.279 0 142.47 0 143.187ZM8.30891 145.508C9.51181 146.894 9.53307 147.211 9.38586 161.696C9.24872 175.22 9.15301 176.488 8.25461 176.675C7.71501 176.787 6.51827 176.062 5.59581 175.064L3.91824 173.25V159.076C3.91824 151.281 4.08616 144.721 4.29159 144.499C5.08364 143.642 7.13567 144.158 8.30891 145.508ZM44.0337 146.921C43.2725 147.744 43.7007 148.333 45.0597 148.333H46.4591V161.54V174.746L48.0292 176.373C49.4275 177.823 50.0275 178 53.522 178C57.152 178 57.5651 177.864 59.0568 176.179C60.1321 174.966 60.4825 174.157 60.1097 173.754C59.7363 173.35 59.0126 173.755 57.9373 174.969C57.0507 175.97 55.8685 176.789 55.3104 176.789C54.374 176.789 54.2956 176.063 54.2956 167.405V158.02H56.8145C58.6801 158.02 59.3333 157.785 59.3333 157.112C59.3333 156.44 58.6801 156.204 56.8145 156.204H54.2956V153.208C54.2956 150.609 54.0543 149.966 52.4764 148.367C50.899 146.768 50.2419 146.522 47.5322 146.52C45.8132 146.518 44.2386 146.699 44.0337 146.921ZM68.1029 146.921C67.3417 147.744 67.7699 148.333 69.1289 148.333H70.5283V161.232V174.13L72.3744 176.065C74.0592 177.832 74.5316 178 77.8011 178C80.9245 178 81.5828 177.792 82.9519 176.373C84.4543 174.817 85.0297 173.156 84.0669 173.156C83.8167 173.156 82.8881 173.974 82.0031 174.973C79.1165 178.232 78.9245 177.763 78.9245 167.439V158.09L81.2598 157.904C84.5998 157.638 84.7935 156.204 81.4898 156.204H78.9245V153.501C78.9245 151.34 78.5758 150.368 77.1871 148.657C75.5476 146.637 75.2537 146.517 71.9629 146.517C70.0452 146.517 68.3078 146.699 68.1029 146.921ZM51.475 149.659C52.5481 150.904 52.6164 151.74 52.6164 163.603C52.6164 174.445 52.4943 176.273 51.7482 176.582C51.2478 176.79 50.2996 176.353 49.5092 175.549L48.1384 174.156V161.245C48.1384 148.823 48.1798 148.333 49.236 148.333C49.84 148.333 50.8475 148.93 51.475 149.659ZM75.95 149.65C77.2235 150.944 77.2453 151.177 77.2453 163.594C77.2453 174.475 77.1244 176.272 76.3721 176.584C75.8437 176.804 74.8501 176.273 73.8532 175.241L72.2075 173.535V160.934C72.2075 148.381 72.212 148.333 73.4312 148.333C74.104 148.333 75.2375 148.925 75.95 149.65ZM21.6589 154.169C21.0242 154.856 21.8582 155.599 23.2626 155.599H24.6289V165.101C24.6289 174.589 24.6312 174.607 26.133 176.302C27.5295 177.879 27.9494 178 32.0103 178C36.1648 178 38.1239 177.086 34.8443 176.678L33.305 176.486L33.0252 166.644L32.7453 156.802L31.1187 155.292C29.7366 154.009 28.9312 153.782 25.7546 153.782C23.6986 153.782 21.8559 153.957 21.6589 154.169ZM95.8267 155.779L94.0377 157.775V165.952V174.13L95.8838 176.065L97.7293 178H105.015H112.3L113.865 176.233C116.115 173.693 115.142 172.506 112.812 174.949C111.072 176.773 110.843 176.839 106.858 176.666L102.714 176.486V172.248V168.01L107.467 167.832C111.726 167.672 112.381 167.488 113.764 166.054C115.101 164.669 115.308 163.984 115.308 160.955C115.308 157.893 115.101 157.227 113.648 155.619L111.987 153.782H104.802H97.6156L95.8267 155.779ZM124.264 154.69C124.264 155.255 124.793 155.599 125.664 155.599H127.063V164.864V174.13L128.909 176.065C130.637 177.878 131.01 178 134.786 178C138.676 178 140.429 177.07 137.278 176.678L135.739 176.486L135.583 167.462C135.436 158.875 135.488 158.368 136.661 157.018C138.126 155.33 141.296 155.097 142.796 156.566C144.385 158.121 145.278 156.934 143.8 155.232C142.09 153.263 138.07 153.193 136.195 155.099L134.899 156.415L133.604 155.099C132.522 153.999 131.646 153.782 128.286 153.782C125.084 153.782 124.264 153.968 124.264 154.69ZM155.995 155.481C154.917 156.697 154.491 157.813 154.491 159.416V161.653H158.409H162.327V158.626V155.599H164.286H166.245V160.442V165.286H161.312C156.638 165.286 156.3 165.375 154.875 166.984C152.781 169.348 152.756 173.484 154.82 176.137C156.204 177.916 156.46 178 160.521 178C164.014 178 164.988 177.782 165.975 176.779L167.176 175.559L168.197 176.779C169.055 177.806 169.917 178 173.609 178C176.163 178 178 177.747 178 177.395C178 177.062 177.37 176.789 176.601 176.789H175.201V167.149C175.201 157.66 175.178 157.479 173.752 155.645L172.303 153.782H164.901C157.522 153.782 157.494 153.788 155.995 155.481ZM30.3221 156.601C31.2317 157.491 31.3459 158.671 31.3459 167.196C31.3459 176.154 31.2771 176.789 30.302 176.789C29.7277 176.789 28.5942 176.224 27.7831 175.534L26.3082 174.28V164.939V155.599H27.8033C28.6255 155.599 29.759 156.05 30.3221 156.601ZM100.755 166.194C100.755 176.021 100.681 176.789 99.7399 176.789C99.1818 176.789 98.0483 176.025 97.221 175.091C95.7545 173.435 95.717 173.207 95.717 165.897C95.717 159.034 95.82 158.283 96.9339 157C97.6033 156.23 98.7368 155.599 99.4527 155.599H100.755V166.194ZM106.912 161.048V166.497H104.673H102.434V161.048V155.599H104.673H106.912V161.048ZM112.725 157.091C114.059 159.294 113.899 163.383 112.412 165.096C111.743 165.866 110.609 166.497 109.893 166.497C108.627 166.497 108.591 166.347 108.591 161.048V155.599H110.206C111.305 155.599 112.11 156.076 112.725 157.091ZM132.756 156.601C133.666 157.491 133.78 158.671 133.78 167.196C133.78 176.055 133.702 176.789 132.765 176.789C132.207 176.789 131.073 176.025 130.246 175.091C128.753 173.406 128.742 173.327 128.742 164.496V155.599H130.237C131.059 155.599 132.193 156.05 132.756 156.601ZM160.648 158.057V160.515L158.553 160.327C157.054 160.193 156.404 159.826 156.266 159.035C156.002 157.532 157.73 155.599 159.335 155.599C160.497 155.599 160.648 155.882 160.648 158.057ZM172.685 157.031C173.39 158.196 173.524 160.149 173.397 167.475C173.243 176.415 173.231 176.488 171.928 176.687C171.135 176.809 170.081 176.347 169.269 175.523C167.963 174.195 167.925 173.891 167.925 164.878V155.599H169.871C171.3 155.599 172.048 155.979 172.685 157.031ZM160.648 171.643C160.648 176.753 160.638 176.789 159.223 176.789C158.44 176.789 157.18 176.12 156.424 175.303C153.622 172.273 155.355 166.497 159.066 166.497H160.648V171.643ZM166.245 170.327C166.245 173.598 166.047 174.358 164.887 175.536C164.141 176.295 163.259 176.735 162.928 176.514C162.582 176.282 162.327 174.077 162.327 171.304V166.497H164.286H166.245V170.327Z" 
        fill="var(--azul-escuro)" stroke="var(--azul-escuro)" stroke-width="2" mask="url(#path-1-inside-1_106_40)"/>
      </svg>



      
      <div id='cx1'>
        <h1 id='textao'>Bem-Vindo de Volta!</h1>
        <div id='cx2'>
          <p id='p1'>Acesse sua conta e continue explorando as ferramentas que facilitam a gestão da sua biblioteca.</p>
        </div>
        <div id='cx3'>
          <button
            className={`btnA ${selected === 'admin' ? 'btnA-selected' : ''}`}
            id='btn1'
            onClick={() => setSelected('admin')}
          >
            Administrador
          </button>
          <button
            className={`btnA ${selected === 'biblio' ? 'btnA-selected' : ''}`}
            id='btn2'
            onClick={() => setSelected('biblio')}
          >
            Bibliotecário(a)
          </button>
        </div>
        <div id='cx4'>
          <div className='cx4-1'>
            <p className='textinho'>Email</p>
            <input 
              className='txt1' 
              type="email" 
              onChange={(e) => setEmail(e.target.value)}/>
          </div>
          <div className='cx4-1'>
            <p className='textinho'>Senha</p>
            <div className="cadastro-input-group">
              <input
                type={showSenha ? "text" : "password"}
                className="cadastro-input"
                onChange={(e) => setSenha(e.target.value)}
              />
              <button
                type="button"
                className="cadastro-eye"
                onClick={() => setShowSenha((v) => !v)}
                tabIndex={-1}
                aria-label="Mostrar/ocultar senha"
              >
                {showSenha ? (
                  <EyeOff size={22} color="#0A4489" />
                ) : (
                  <Eye size={22} color="#0A4489" />
                )}
              </button>
            </div>
          </div>
        </div>
         <button className="btn-cadastrar" onClick={handleClick}>
          <LogIn className="btn-cadastrar-img" />
          <span className="btn-cadastrar-divider"></span>
          <span className="btn-cadastrar-text">Log in</span>
        </button>
        <div id='cx5'>
          <p className='textinho'>Ainda não possui um cadastro?</p>
          <a onClick={() => navigate('/cadastro')} style={{ cursor: 'pointer' }}>Cadastre-se</a>
        </div>
      </div>
    </div>
      
    </>
  )
}

export default Login;